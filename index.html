<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fragment Sphere Studio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100%;
            height: 100vh;
            background: radial-gradient(circle at 30% 20%, #fafafa 0%, #e8e8e8 40%, #d0d0d0 100%);
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30%;
            background: radial-gradient(ellipse at 50% 100%, rgba(0,0,0,0.12) 0%, transparent 65%);
            pointer-events: none;
        }

        #canvas-container {
            width: 100%;
            height: 100%;
        }

        .control-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 16px 48px rgba(0,0,0,0.1);
            max-width: 360px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            z-index: 10;
            backdrop-filter: blur(20px);
        }

        .control-panel h2 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #1a1a1a;
            letter-spacing: -0.5px;
        }

        .subtitle {
            font-size: 11px;
            color: #888;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .control-group {
            margin-bottom: 24px;
        }

        .control-group h3 {
            font-size: 11px;
            font-weight: 700;
            color: #888;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .control-item {
            margin-bottom: 14px;
        }

        .control-item label {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #333;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .value-display {
            font-weight: 700;
            color: #1a1a1a;
            font-variant-numeric: tabular-nums;
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #1a1a1a;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #1a1a1a;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .color-picker-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .color-swatch {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: #f8f8f8;
            border-radius: 6px;
            cursor: pointer;
            border: 1px solid #e0e0e0;
        }

        .color-swatch input[type="color"] {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .color-swatch label {
            font-size: 10px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            cursor: pointer;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .preset-btn {
            padding: 10px;
            background: linear-gradient(135deg, #f8f8f8 0%, #f0f0f0 100%);
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .preset-btn:hover {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .stats-display {
            background: linear-gradient(135deg, #f8f8f8 0%, #f0f0f0 100%);
            padding: 12px;
            border-radius: 8px;
            font-size: 11px;
            color: #666;
            margin-top: 16px;
        }

        .stats-display strong {
            color: #1a1a1a;
        }

        .toggle-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            z-index: 11;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.08);
        }

        .toggle-btn:hover {
            background: #1a1a1a;
            color: white;
        }

        .reset-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            margin-top: 12px;
            transition: all 0.2s;
        }

        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,68,68,0.3);
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>

    <div class="toggle-btn" onclick="togglePanel()">â˜° CONTROLS</div>

    <div class="control-panel" id="controlPanel">
        <h2>ðŸ’¥ Fragment Sphere</h2>
        <div class="subtitle">Advanced Fragment Displacement</div>

        <!-- Quick Presets -->
        <div class="control-group">
            <h3>Quick Presets</h3>
            <div class="preset-grid">
                <button class="preset-btn" onclick="applyPreset('dark')">âš« DARK VOID</button>
                <button class="preset-btn" onclick="applyPreset('minimal')">âšª MINIMAL</button>
                <button class="preset-btn" onclick="applyPreset('chaos')">ðŸ”¥ CHAOS</button>
                <button class="preset-btn" onclick="applyPreset('elegant')">âœ¨ ELEGANT</button>
            </div>
        </div>

        <!-- Structure -->
        <div class="control-group">
            <h3>Structure</h3>
            
            <div class="control-item">
                <label>
                    <span>Layer Count</span>
                    <span class="value-display" id="shellCountValue">18</span>
                </label>
                <input type="range" id="shellCount" min="8" max="35" value="18" step="1">
            </div>

            <div class="control-item">
                <label>
                    <span>Detail Level</span>
                    <span class="value-display" id="detailValue">2</span>
                </label>
                <input type="range" id="detail" min="0" max="4" value="2" step="1">
            </div>

            <div class="control-item">
                <label>
                    <span>Base Radius</span>
                    <span class="value-display" id="baseRadiusValue">0.60</span>
                </label>
                <input type="range" id="baseRadius" min="0.3" max="1.0" value="0.60" step="0.05">
            </div>

            <div class="control-item">
                <label>
                    <span>Radius Growth</span>
                    <span class="value-display" id="radiusGrowthValue">0.60</span>
                </label>
                <input type="range" id="radiusGrowth" min="0.2" max="1.2" value="0.60" step="0.05">
            </div>
        </div>

        <!-- Fragment Behavior -->
        <div class="control-group">
            <h3>Fragment Behavior</h3>
            
            <div class="control-item">
                <label>
                    <span>Fragment Density</span>
                    <span class="value-display" id="fragmentDensityValue">45%</span>
                </label>
                <input type="range" id="fragmentDensity" min="0" max="100" value="45" step="5">
            </div>

            <div class="control-item">
                <label>
                    <span>Displacement Min</span>
                    <span class="value-display" id="dispMinValue">0.05</span>
                </label>
                <input type="range" id="dispMin" min="0" max="0.5" value="0.05" step="0.01">
            </div>

            <div class="control-item">
                <label>
                    <span>Displacement Max</span>
                    <span class="value-display" id="dispMaxValue">0.35</span>
                </label>
                <input type="range" id="dispMax" min="0.1" max="1.5" value="0.35" step="0.05">
            </div>

            <div class="control-item">
                <label>
                    <span>Fragment Twist</span>
                    <span class="value-display" id="twistValue">0.15</span>
                </label>
                <input type="range" id="twist" min="0" max="0.8" value="0.15" step="0.01">
            </div>

            <div class="control-item">
                <label>
                    <span>Randomness</span>
                    <span class="value-display" id="randomnessValue">1.00</span>
                </label>
                <input type="range" id="randomness" min="0" max="2" value="1.00" step="0.1">
            </div>
        </div>

        <!-- Color -->
        <div class="control-group">
            <h3>Color</h3>
            
            <div class="color-picker-group">
                <div class="color-swatch">
                    <input type="color" id="color1" value="#1a1a1a">
                    <label for="color1">CORE</label>
                </div>
                <div class="color-swatch">
                    <input type="color" id="color2" value="#f5f5f5">
                    <label for="color2">OUTER</label>
                </div>
                <div class="color-swatch">
                    <input type="color" id="accentColor" value="#ccff00">
                    <label for="accentColor">ACCENT</label>
                </div>
                <div class="color-swatch">
                    <input type="color" id="bgColor" value="#e8e8e8">
                    <label for="bgColor">BG</label>
                </div>
            </div>

            <div class="control-item" style="margin-top: 12px;">
                <label>
                    <span>Accent Position</span>
                    <span class="value-display" id="accentPosValue">0.60</span>
                </label>
                <input type="range" id="accentPos" min="0" max="1" value="0.60" step="0.05">
            </div>

            <div class="control-item">
                <label>
                    <span>Accent Width</span>
                    <span class="value-display" id="accentWidthValue">0.20</span>
                </label>
                <input type="range" id="accentWidth" min="0.05" max="0.5" value="0.20" step="0.05">
            </div>

            <div class="control-item">
                <label>
                    <span>Accent Intensity</span>
                    <span class="value-display" id="accentIntensityValue">0.90</span>
                </label>
                <input type="range" id="accentIntensity" min="0" max="1" value="0.90" step="0.05">
            </div>
        </div>

        <!-- Material -->
        <div class="control-group">
            <h3>Material</h3>
            
            <div class="control-item">
                <label>
                    <span>Roughness</span>
                    <span class="value-display" id="roughnessValue">0.88</span>
                </label>
                <input type="range" id="roughness" min="0" max="1" value="0.88" step="0.02">
            </div>

            <div class="control-item">
                <label>
                    <span>Metalness</span>
                    <span class="value-display" id="metalnessValue">0.05</span>
                </label>
                <input type="range" id="metalness" min="0" max="1" value="0.05" step="0.01">
            </div>

            <div class="control-item">
                <label>
                    <span>Flat Shading</span>
                    <span class="value-display" id="flatShadingValue">ON</span>
                </label>
                <input type="range" id="flatShading" min="0" max="1" value="1" step="1">
            </div>
        </div>

        <!-- Lighting -->
        <div class="control-group">
            <h3>Lighting</h3>
            
            <div class="control-item">
                <label>
                    <span>Key Light Power</span>
                    <span class="value-display" id="keyLightValue">2.00</span>
                </label>
                <input type="range" id="keyLight" min="0" max="5" value="2.00" step="0.1">
            </div>

            <div class="control-item">
                <label>
                    <span>Fill Light</span>
                    <span class="value-display" id="fillLightValue">0.40</span>
                </label>
                <input type="range" id="fillLight" min="0" max="2" value="0.40" step="0.1">
            </div>

            <div class="control-item">
                <label>
                    <span>Rim Light</span>
                    <span class="value-display" id="rimLightValue">0.80</span>
                </label>
                <input type="range" id="rimLight" min="0" max="2" value="0.80" step="0.1">
            </div>

            <div class="control-item">
                <label>
                    <span>Ambient Light</span>
                    <span class="value-display" id="ambientValue">0.30</span>
                </label>
                <input type="range" id="ambient" min="0" max="1" value="0.30" step="0.05">
            </div>
        </div>

        <!-- Animation -->
        <div class="control-group">
            <h3>Animation</h3>
            
            <div class="control-item">
                <label>
                    <span>Rotation Speed</span>
                    <span class="value-display" id="rotSpeedValue">0.003</span>
                </label>
                <input type="range" id="rotSpeed" min="0" max="0.02" value="0.003" step="0.001">
            </div>

            <div class="control-item">
                <label>
                    <span>Auto-Rotate Y</span>
                    <span class="value-display" id="autoRotateValue">ON</span>
                </label>
                <input type="range" id="autoRotate" min="0" max="1" value="1" step="1">
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-display" id="stats">
            <strong>Fragments:</strong> <span id="primitiveCount">0</span><br>
            <strong>FPS:</strong> <span id="fpsCounter">60</span>
        </div>

        <button class="reset-btn" onclick="resetToDefault()">ðŸ”„ RESET TO DEFAULT</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
    <script>
        // ========== SCENE SETUP ==========
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(38, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ 
            antialias: true,
            alpha: true,
            powerPreference: "high-performance"
        });
        
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.outputEncoding = THREE.sRGBEncoding;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 0.95;
        
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const sphereGroup = new THREE.Group();
        scene.add(sphereGroup);

        camera.position.set(0, 0.8, 6);
        camera.lookAt(0, 0, 0);

        // ========== CONFIG ==========
        let config = {
            shellCount: 18,
            detail: 2,
            baseRadius: 0.60,
            radiusGrowth: 0.60,
            fragmentDensity: 0.45,
            dispMin: 0.05,
            dispMax: 0.35,
            twist: 0.15,
            randomness: 1.00,
            color1: new THREE.Color(0x1a1a1a),
            color2: new THREE.Color(0xf5f5f5),
            accentColor: new THREE.Color(0xccff00),
            bgColor: new THREE.Color(0xe8e8e8),
            accentPos: 0.60,
            accentWidth: 0.20,
            accentIntensity: 0.90,
            roughness: 0.88,
            metalness: 0.05,
            flatShading: true,
            keyLight: 2.00,
            fillLight: 0.40,
            rimLight: 0.80,
            ambient: 0.30,
            rotSpeed: 0.003,
            autoRotate: true
        };

        // Store default config
        const defaultConfig = JSON.parse(JSON.stringify({...config, 
            color1: config.color1.getHex(),
            color2: config.color2.getHex(),
            accentColor: config.accentColor.getHex(),
            bgColor: config.bgColor.getHex()
        }));

        // ========== LIGHTING ==========
        let ambientLight = new THREE.AmbientLight(0xffffff, config.ambient);
        scene.add(ambientLight);

        let keyLight = new THREE.DirectionalLight(0xffffff, config.keyLight);
        keyLight.position.set(7, 12, 5);
        keyLight.castShadow = true;
        keyLight.shadow.mapSize.width = 2048;
        keyLight.shadow.mapSize.height = 2048;
        scene.add(keyLight);

        let fillLight = new THREE.DirectionalLight(0xffffff, config.fillLight);
        fillLight.position.set(-6, 3, -4);
        scene.add(fillLight);

        let rimLight = new THREE.DirectionalLight(0xffffff, config.rimLight);
        rimLight.position.set(0, -3, -8);
        scene.add(rimLight);

        // ========== COLOR FUNCTION WITH ACCENT ==========
        function getLayerColor(layerIndex, totalLayers) {
            const t = layerIndex / (totalLayers - 1 || 1);
            
            // Accent zone
            const accentStart = config.accentPos - config.accentWidth / 2;
            const accentEnd = config.accentPos + config.accentWidth / 2;
            
            if (t >= accentStart && t <= accentEnd) {
                const accentT = (t - accentStart) / config.accentWidth;
                const accentStrength = Math.sin(accentT * Math.PI) * config.accentIntensity;
                const baseColor = new THREE.Color().lerpColors(config.color1, config.color2, t);
                return new THREE.Color().lerpColors(baseColor, config.accentColor, accentStrength);
            }
            
            return new THREE.Color().lerpColors(config.color1, config.color2, t);
        }

        // ========== FRAGMENT LAYER BUILDER ==========
        function createFragmentLayer(radius, layerIndex, totalLayers) {
            const baseGeometry = new THREE.IcosahedronGeometry(radius, config.detail);
            const positions = baseGeometry.attributes.position;
            const fragments = [];
            
            for (let i = 0; i < positions.count; i += 3) {
                if (Math.random() > config.fragmentDensity) continue;
                
                const v1 = new THREE.Vector3(positions.getX(i), positions.getY(i), positions.getZ(i));
                const v2 = new THREE.Vector3(positions.getX(i+1), positions.getY(i+1), positions.getZ(i+1));
                const v3 = new THREE.Vector3(positions.getX(i+2), positions.getY(i+2), positions.getZ(i+2));
                
                const center = new THREE.Vector3().add(v1).add(v2).add(v3).divideScalar(3);
                const normal = center.clone().normalize();
                
                const layerFactor = layerIndex / totalLayers;
                const displacement = config.dispMin + (config.dispMax - config.dispMin) * layerFactor * Math.random() * config.randomness;
                const displacementVector = normal.multiplyScalar(displacement);
                
                v1.add(displacementVector);
                v2.add(displacementVector);
                v3.add(displacementVector);
                
                const twist = (Math.random() - 0.5) * config.twist * layerFactor * config.randomness;
                const quaternion = new THREE.Quaternion().setFromAxisAngle(normal, twist);
                
                v1.sub(center).applyQuaternion(quaternion).add(center);
                v2.sub(center).applyQuaternion(quaternion).add(center);
                v3.sub(center).applyQuaternion(quaternion).add(center);
                
                fragments.push(v1, v2, v3);
            }

            if (fragments.length === 0) return null;

            const fragmentGeometry = new THREE.BufferGeometry();
            const vertices = [];
            fragments.forEach(v => vertices.push(v.x, v.y, v.z));
            
            fragmentGeometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            fragmentGeometry.computeVertexNormals();

            const material = new THREE.MeshStandardMaterial({
                color: getLayerColor(layerIndex, totalLayers),
                metalness: config.metalness,
                roughness: config.roughness,
                flatShading: config.flatShading,
                side: THREE.DoubleSide
            });

            const mesh = new THREE.Mesh(fragmentGeometry, material);
            mesh.castShadow = true;
            mesh.receiveShadow = true;

            return mesh;
        }

        // ========== REBUILD SPHERE ==========
        let rebuildTimeout = null;
        function rebuildSphere() {
            clearTimeout(rebuildTimeout);
            rebuildTimeout = setTimeout(() => {
                while(sphereGroup.children.length > 0) {
                    const child = sphereGroup.children[0];
                    child.traverse(obj => {
                        if (obj.geometry) obj.geometry.dispose();
                        if (obj.material) obj.material.dispose();
                    });
                    sphereGroup.remove(child);
                }

                let primitiveCount = 0;
                
                for (let i = 0; i < config.shellCount; i++) {
                    const t = i / (config.shellCount - 1 || 1);
                    const radius = config.baseRadius + config.radiusGrowth * t * t;
                    
                    const layer = createFragmentLayer(radius, i, config.shellCount);
                    
                    if (layer) {
                        sphereGroup.add(layer);
                        layer.traverse(obj => {
                            if (obj.geometry) primitiveCount++;
                        });
                    }
                }

                document.getElementById('primitiveCount').textContent = primitiveCount;
            }, 100);
        }

        rebuildSphere();

        // ========== CONTROLS ==========
        function updateControl(id, property, multiplier = 1, decimals = 2, suffix = '', onOffMode = false) {
            const element = document.getElementById(id);
            const valueDisplay = document.getElementById(id + 'Value');
            
            element.addEventListener('input', (e) => {
                if (onOffMode) {
                    config[property] = parseFloat(e.target.value) === 1;
                    valueDisplay.textContent = config[property] ? 'ON' : 'OFF';
                } else {
                    config[property] = parseFloat(e.target.value) * multiplier;
                    valueDisplay.textContent = (parseFloat(e.target.value) * multiplier).toFixed(decimals) + suffix;
                }
                
                if (property === 'ambient') ambientLight.intensity = config.ambient;
                if (property === 'keyLight') keyLight.intensity = config.keyLight;
                if (property === 'fillLight') fillLight.intensity = config.fillLight;
                if (property === 'rimLight') rimLight.intensity = config.rimLight;
                
                if (['shellCount', 'detail', 'baseRadius', 'radiusGrowth', 'fragmentDensity', 
                     'dispMin', 'dispMax', 'twist', 'randomness',
                     'roughness', 'metalness', 'flatShading', 'accentPos', 'accentWidth', 'accentIntensity'].includes(property)) {
                    rebuildSphere();
                }
            });
        }

        updateControl('shellCount', 'shellCount', 1, 0);
        updateControl('detail', 'detail', 1, 0);
        updateControl('baseRadius', 'baseRadius', 1, 2);
        updateControl('radiusGrowth', 'radiusGrowth', 1, 2);
        updateControl('fragmentDensity', 'fragmentDensity', 0.01, 0, '%');
        updateControl('dispMin', 'dispMin', 1, 2);
        updateControl('dispMax', 'dispMax', 1, 2);
        updateControl('twist', 'twist', 1, 2);
        updateControl('randomness', 'randomness', 1, 2);
        updateControl('accentPos', 'accentPos', 1, 2);
        updateControl('accentWidth', 'accentWidth', 1, 2);
        updateControl('accentIntensity', 'accentIntensity', 1, 2);
        updateControl('roughness', 'roughness', 1, 2);
        updateControl('metalness', 'metalness', 1, 2);
        updateControl('flatShading', 'flatShading', 1, 0, '', true);
        updateControl('keyLight', 'keyLight', 1, 2);
        updateControl('fillLight', 'fillLight', 1, 2);
        updateControl('rimLight', 'rimLight', 1, 2);
        updateControl('ambient', 'ambient', 1, 2);
        updateControl('rotSpeed', 'rotSpeed', 1, 3);
        updateControl('autoRotate', 'autoRotate', 1, 0, '', true);

        // Color pickers
        ['color1', 'color2', 'accentColor', 'bgColor'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                config[id] = new THREE.Color(e.target.value);
                if (id === 'bgColor') {
                    document.body.style.background = `radial-gradient(circle at 30% 20%, ${e.target.value} 0%, ${adjustBrightness(e.target.value, -10)} 40%, ${adjustBrightness(e.target.value, -25)} 100%)`;
                } else {
                    rebuildSphere();
                }
            });
        });

        function adjustBrightness(hex, percent) {
            const num = parseInt(hex.replace('#', ''), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return '#' + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255))
                .toString(16).slice(1);
        }

        // ========== PRESETS ==========
        function applyPreset(preset) {
            const presets = {
                dark: {
                    shellCount: 22,
                    detail: 2,
                    baseRadius: 0.55,
                    radiusGrowth: 0.65,
                    fragmentDensity: 0.65,
                    dispMin: 0.08,
                    dispMax: 0.55,
                    twist: 0.28,
                    randomness: 1.2,
                    color1: '#000000',
                    color2: '#404040',
                    accentColor: '#1a1a1a',
                    roughness: 0.92,
                    metalness: 0.15,
                    flatShading: true,
                    keyLight: 2.5,
                    fillLight: 0.3,
                    rimLight: 1.0
                },
                minimal: {
                    shellCount: 12,
                    detail: 1,
                    baseRadius: 0.70,
                    radiusGrowth: 0.40,
                    fragmentDensity: 0.30,
                    dispMin: 0.02,
                    dispMax: 0.18,
                    twist: 0.08,
                    randomness: 0.6,
                    color1: '#f0f0f0',
                    color2: '#ffffff',
                    accentColor: '#e8e8e8',
                    roughness: 0.95,
                    metalness: 0.0,
                    flatShading: false,
                    keyLight: 1.5,
                    fillLight: 0.5
                },
                chaos: {
                    shellCount: 28,
                    detail: 3,
                    baseRadius: 0.50,
                    radiusGrowth: 0.75,
                    fragmentDensity: 0.80,
                    dispMin: 0.18,
                    dispMax: 0.85,
                    twist: 0.45,
                    randomness: 1.8,
                    color1: '#1a1a1a',
                    color2: '#808080',
                    accentColor: '#ff4400',
                    accentIntensity: 1.0,
                    roughness: 0.80,
                    metalness: 0.25,
                    flatShading: true,
                    keyLight: 2.8
                },
                elegant: {
                    shellCount: 16,
                    detail: 2,
                    baseRadius: 0.65,
                    radiusGrowth: 0.50,
                    fragmentDensity: 0.50,
                    dispMin: 0.05,
                    dispMax: 0.30,
                    twist: 0.12,
                    randomness: 0.85,
                    color1: '#2a2a2a',
                    color2: '#d0d0d0',
                    accentColor: '#00ccff',
                    accentPos: 0.50,
                    accentWidth: 0.15,
                    accentIntensity: 0.75,
                    roughness: 0.85,
                    metalness: 0.10,
                    flatShading: false,
                    keyLight: 2.0,
                    fillLight: 0.45
                }
            };

            const p = presets[preset];
            
            Object.keys(p).forEach(key => {
                if (key.includes('color') || key === 'bgColor') {
                    config[key] = new THREE.Color(p[key]);
                    document.getElementById(key).value = p[key];
                    if (key === 'bgColor') {
                        document.body.style.background = `radial-gradient(circle at 30% 20%, ${p[key]} 0%, ${adjustBrightness(p[key], -10)} 40%, ${adjustBrightness(p[key], -25)} 100%)`;
                    }
                } else {
                    config[key] = p[key];
                    const input = document.getElementById(key);
                    if (input) {
                        if (key === 'fragmentDensity') {
                            input.value = p[key] * 100;
                        } else if (key === 'flatShading' || key === 'autoRotate') {
                            input.value = p[key] ? 1 : 0;
                        } else {
                            input.value = p[key];
                        }
                        input.dispatchEvent(new Event('input'));
                    }
                }
            });
        }

        // ========== RESET FUNCTION ==========
        function resetToDefault() {
            Object.keys(defaultConfig).forEach(key => {
                if (key.includes('color') || key === 'bgColor') {
                    config[key] = new THREE.Color(defaultConfig[key]);
                    document.getElementById(key).value = '#' + defaultConfig[key].toString(16).padStart(6, '0');
                } else {
                    config[key] = defaultConfig[key];
                    const input = document.getElementById(key);
                    if (input) {
                        if (key === 'fragmentDensity') {
                            input.value = defaultConfig[key] * 100;
                        } else {
                            input.value = defaultConfig[key];
                        }
                        input.dispatchEvent(new Event('input'));
                    }
                }
            });
        }

        // ========== UI FUNCTIONS ==========
        function togglePanel() {
            const panel = document.getElementById('controlPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // ========== FPS COUNTER ==========
        let lastTime = performance.now();
        let frames = 0;
        function updateFPS() {
            frames++;
            const currentTime = performance.now();
            if (currentTime >= lastTime + 1000) {
                document.getElementById('fpsCounter').textContent = frames;
                frames = 0;
                lastTime = currentTime;
            }
        }

        // ========== ANIMATION ==========
        function animate() {
            requestAnimationFrame(animate);
            if (config.autoRotate) {
                sphereGroup.rotation.y += config.rotSpeed;
            }
            renderer.render(scene, camera);
            updateFPS();
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>
